# üåê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ DNS –¥–ª—è –¥–æ–º–µ–Ω–∞

–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ DNS –∑–∞–ø–∏—Å–µ–π –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ –æ—Ç Let's Encrypt.

## üî¥ –ü—Ä–æ–±–ª–µ–º–∞: "DNS problem: SERVFAIL"

–≠—Ç–∞ –æ—à–∏–±–∫–∞ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ DNS –∑–∞–ø–∏—Å–∏ –¥–ª—è –≤–∞—à–µ–≥–æ –¥–æ–º–µ–Ω–∞ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –∏–ª–∏ –Ω–µ —É–∫–∞–∑—ã–≤–∞—é—Ç –Ω–∞ IP –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞.

## ‚úÖ –†–µ—à–µ–Ω–∏–µ: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ DNS –∑–∞–ø–∏—Å–µ–π

### –®–∞–≥ 1: –£–∑–Ω–∞–π—Ç–µ IP –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞

–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
# –í–∞—Ä–∏–∞–Ω—Ç 1: –í–Ω–µ—à–Ω–∏–π IP
curl ifconfig.me

# –í–∞—Ä–∏–∞–Ω—Ç 2: –ò–ª–∏
curl ipinfo.io/ip

# –í–∞—Ä–∏–∞–Ω—Ç 3: –ò–ª–∏
hostname -I | awk '{print $1}'
```

–ó–∞–ø–∏—à–∏—Ç–µ —ç—Ç–æ—Ç IP –∞–¥—Ä–µ—Å (–Ω–∞–ø—Ä–∏–º–µ—Ä: `185.123.45.67`)

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ DNS –∑–∞–ø–∏—Å–∏ —É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –¥–æ–º–µ–Ω–∞

–ó–∞–π–¥–∏—Ç–µ –≤ –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–∞—à–µ–≥–æ –¥–æ–º–µ–Ω–∞ (–≥–¥–µ –≤—ã –µ–≥–æ –ø–æ–∫—É–ø–∞–ª–∏) –∏ –Ω–∞–π–¥–∏—Ç–µ —Ä–∞–∑–¥–µ–ª "DNS" –∏–ª–∏ "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ DNS".

#### –ù—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å A-–∑–∞–ø–∏—Å—å:

| –¢–∏–ø | –ò–º—è/–ü–æ–¥–¥–æ–º–µ–Ω | –ó–Ω–∞—á–µ–Ω–∏–µ/IP | TTL |
|-----|--------------|-------------|-----|
| A   | @ (–∏–ª–∏ –ø—É—Å—Ç–æ) | YOUR_IP     | 3600 (–∏–ª–∏ Auto) |
| A   | www          | YOUR_IP     | 3600 (–∏–ª–∏ Auto) |

**–ü—Ä–∏–º–µ—Ä:**
- **–¢–∏–ø:** A
- **–ò–º—è:** @ (–∏–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º, –∏–ª–∏ `tomyangbarnew.ru`)
- **–ó–Ω–∞—á–µ–Ω–∏–µ:** `185.123.45.67` (–≤–∞—à IP)
- **TTL:** 3600 (–∏–ª–∏ Auto)

**–¢–∞–∫–∂–µ —Å–æ–∑–¥–∞–π—Ç–µ –∑–∞–ø–∏—Å—å –¥–ª—è www:**
- **–¢–∏–ø:** A
- **–ò–º—è:** www
- **–ó–Ω–∞—á–µ–Ω–∏–µ:** `185.123.45.67` (–≤–∞—à IP)
- **TTL:** 3600 (–∏–ª–∏ Auto)

### –®–∞–≥ 3: –ì–¥–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å DNS (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞)

#### –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã:

**Reg.ru / REG.RU:**
1. –ó–∞–π–¥–∏—Ç–µ –Ω–∞ reg.ru
2. –ú–æ–π –¥–æ–º–µ–Ω ‚Üí –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ‚Üí DNS-—Å–µ—Ä–≤–µ—Ä—ã –∏ –∑–æ–Ω–∞
3. –î–æ–±–∞–≤—å—Ç–µ A-–∑–∞–ø–∏—Å—å —Å IP –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞

**Timeweb:**
1. –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è ‚Üí –î–æ–º–µ–Ω—ã ‚Üí DNS-–∑–∞–ø–∏—Å–∏
2. –î–æ–±–∞–≤—å—Ç–µ A-–∑–∞–ø–∏—Å—å

**Namecheap:**
1. Domain List ‚Üí Manage ‚Üí Advanced DNS
2. Add New Record ‚Üí A Record

**GoDaddy:**
1. My Products ‚Üí DNS ‚Üí Records
2. Add ‚Üí A record

**Cloudflare:**
1. DNS ‚Üí Records
2. Add record ‚Üí Type: A, Name: @, IPv4: YOUR_IP

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ DNS –∑–∞–ø–∏—Å–µ–π

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ DNS –Ω—É–∂–Ω–æ –ø–æ–¥–æ–∂–¥–∞—Ç—å **5-60 –º–∏–Ω—É—Ç** (–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç TTL) –¥–ª—è —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –∑–∞–ø–∏—Å–µ–π.

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ DNS —Ä–∞–±–æ—Ç–∞–µ—Ç:

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ
dig tomyangbarnew.ru
# –∏–ª–∏
nslookup tomyangbarnew.ru

# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤–∞—à IP –∞–¥—Ä–µ—Å
```

**–û–Ω–ª–∞–π–Ω –ø—Ä–æ–≤–µ—Ä–∫–∞:**
- https://dnschecker.org/#A/tomyangbarnew.ru
- https://mxtoolbox.com/DNSLookup.aspx

### –®–∞–≥ 5: –ü–æ–ª—É—á–µ–Ω–∏–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞

–ü–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ DNS –∑–∞–ø–∏—Å–∏ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–∏–ª–∏—Å—å (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ —á–µ—Ä–µ–∑ `dig` –∏–ª–∏ –æ–Ω–ª–∞–π–Ω-—Å–µ—Ä–≤–∏—Å—ã), –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞:

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ, –≤ –ø–∞–ø–∫–µ –ø—Ä–æ–µ–∫—Ç–∞
cd /root/tomyangbar

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã (–≤–∞–∂–Ω–æ!)
docker-compose down

# –ü–æ–ª—É—á–∏—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
sudo certbot certonly --standalone -d tomyangbarnew.ru -d www.tomyangbarnew.ru

# –ï—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ, —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
mkdir -p ssl
sudo cp /etc/letsencrypt/live/tomyangbarnew.ru/fullchain.pem ./ssl/
sudo cp /etc/letsencrypt/live/tomyangbarnew.ru/privkey.pem ./ssl/
sudo chmod 644 ./ssl/fullchain.pem
sudo chmod 600 ./ssl/privkey.pem
sudo chown $USER:$USER ./ssl/*

# –û–±–Ω–æ–≤–∏—Ç–µ .env
nano .env
# –ò–∑–º–µ–Ω–∏—Ç–µ: FRONTEND_URL=https://tomyangbarnew.ru

# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
cp docker-compose.https.yml docker-compose.yml

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ
docker-compose up -d --build
```

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –ø–æ–ª—É—á–µ–Ω–∏–µ–º —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ:

1. ‚úÖ DNS –∑–∞–ø–∏—Å–∏ —Å–æ–∑–¥–∞–Ω—ã
2. ‚úÖ DNS –∑–∞–ø–∏—Å–∏ —É–∫–∞–∑—ã–≤–∞—é—Ç –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π IP
3. ‚úÖ –ü—Ä–æ—à–ª–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ —á–µ—Ä–µ–∑ `dig`)
4. ‚úÖ –ü–æ—Ä—Ç 80 –æ—Ç–∫—Ä—ã—Ç –∏ –¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑–≤–Ω–µ
5. ‚úÖ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã (—á—Ç–æ–±—ã certbot –º–æ–≥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ—Ä—Ç 80)

## üêõ –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### "DNS problem: SERVFAIL"

**–ü—Ä–∏—á–∏–Ω—ã:**
- DNS –∑–∞–ø–∏—Å–∏ –µ—â–µ –Ω–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–∏–ª–∏—Å—å (–ø–æ–¥–æ–∂–¥–∏—Ç–µ 5-60 –º–∏–Ω—É—Ç)
- DNS –∑–∞–ø–∏—Å–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
- –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ nameservers

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ DNS —á–µ—Ä–µ–∑ `dig tomyangbarnew.ru`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π IP
3. –ü–æ–¥–æ–∂–¥–∏—Ç–µ –µ—â–µ –Ω–µ–º–Ω–æ–≥–æ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞

### "Connection refused" –∏–ª–∏ "Port 80 is already in use"

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker-compose down

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ—Ä—Ç 80 —Å–≤–æ–±–æ–¥–µ–Ω
sudo netstat -tulpn | grep :80

# –ï—Å–ª–∏ –∑–∞–Ω—è—Ç, –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å
sudo systemctl stop nginx  # –µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —Å–∏—Å—Ç–µ–º–Ω—ã–π nginx
```

### "Failed to download challenge files"

**–ü—Ä–∏—á–∏–Ω—ã:**
- Firewall –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ—Ä—Ç 80
- DNS –Ω–µ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —ç—Ç–æ—Ç —Å–µ—Ä–≤–µ—Ä

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –û—Ç–∫—Ä–æ–π—Ç–µ –ø–æ—Ä—Ç 80
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw reload

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ DNS
dig tomyangbarnew.ru
```

## üìã –ß–µ–∫–ª–∏—Å—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

- [ ] –£–∑–Ω–∞–ª IP —Å–µ—Ä–≤–µ—Ä–∞
- [ ] –ó–∞—à–µ–ª –≤ –ø–∞–Ω–µ–ª—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –¥–æ–º–µ–Ω–∞
- [ ] –°–æ–∑–¥–∞–ª A-–∑–∞–ø–∏—Å—å –¥–ª—è @ (–∫–æ—Ä–Ω–µ–≤–æ–π –¥–æ–º–µ–Ω)
- [ ] –°–æ–∑–¥–∞–ª A-–∑–∞–ø–∏—Å—å –¥–ª—è www
- [ ] –ü–æ–¥–æ–∂–¥–∞–ª 5-60 –º–∏–Ω—É—Ç
- [ ] –ü—Ä–æ–≤–µ—Ä–∏–ª DNS —á–µ—Ä–µ–∑ `dig tomyangbarnew.ru`
- [ ] –£–±–µ–¥–∏–ª—Å—è, —á—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π IP
- [ ] –û—Å—Ç–∞–Ω–æ–≤–∏–ª –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã (`docker-compose down`)
- [ ] –û—Ç–∫—Ä—ã–ª –ø–æ—Ä—Ç—ã 80 –∏ 443 –≤ firewall
- [ ] –ó–∞–ø—É—Å—Ç–∏–ª certbot

## üí° –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ DNS
dig tomyangbarnew.ru
dig www.tomyangbarnew.ru

# –ü—Ä–æ–≤–µ—Ä–∫–∞ IP —Å–µ—Ä–≤–µ—Ä–∞
curl ifconfig.me

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤
sudo netstat -tulpn | grep :80
sudo netstat -tulpn | grep :443

# –ü—Ä–æ–≤–µ—Ä–∫–∞ firewall
sudo ufw status

# –õ–æ–≥–∏ certbot
sudo tail -f /var/log/letsencrypt/letsencrypt.log
```

## üéØ –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞

1. –û–±–Ω–æ–≤–∏—Ç–µ `FRONTEND_URL` –≤ `.env` –Ω–∞ `https://tomyangbarnew.ru`
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `docker-compose.https.yml`
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ (cron)
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É —Å–∞–π—Ç–∞: `https://tomyangbarnew.ru`




