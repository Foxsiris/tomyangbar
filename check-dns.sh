#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ DNS –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–µ—Ä–µ–¥ –ø–æ–ª—É—á–µ–Ω–∏–µ–º SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ./check-dns.sh tomyangbarnew.ru

set -e

DOMAIN=$1

if [ -z "$DOMAIN" ]; then
    echo "‚ùå –û—à–∏–±–∫–∞: –£–∫–∞–∂–∏—Ç–µ –¥–æ–º–µ–Ω"
    echo "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ./check-dns.sh your-domain.com"
    exit 1
fi

echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ DNS –¥–ª—è –¥–æ–º–µ–Ω–∞: $DOMAIN"
echo ""

# –ü–æ–ª—É—á–µ–Ω–∏–µ IP —Å–µ—Ä–≤–µ—Ä–∞
echo "üì° –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ IP —ç—Ç–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞..."
SERVER_IP=$(curl -s ifconfig.me || curl -s ipinfo.io/ip || hostname -I | awk '{print $1}')

if [ -z "$SERVER_IP" ]; then
    echo "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å IP —Å–µ—Ä–≤–µ—Ä–∞"
    exit 1
fi

echo "‚úÖ IP —Å–µ—Ä–≤–µ—Ä–∞: $SERVER_IP"
echo ""

# –ü—Ä–æ–≤–µ—Ä–∫–∞ DNS –∑–∞–ø–∏—Å–∏ –¥–ª—è –¥–æ–º–µ–Ω–∞
echo "üåê –ü—Ä–æ–≤–µ—Ä–∫–∞ DNS –∑–∞–ø–∏—Å–∏ –¥–ª—è $DOMAIN..."
DOMAIN_IP=$(dig +short $DOMAIN | head -1)

if [ -z "$DOMAIN_IP" ]; then
    echo "‚ùå DNS –∑–∞–ø–∏—Å—å –¥–ª—è $DOMAIN –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –∏–ª–∏ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞"
    echo ""
    echo "üìã –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:"
    echo "  1. –ó–∞–π–¥–∏—Ç–µ –≤ –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–∞—à–µ–≥–æ –¥–æ–º–µ–Ω–∞ (–≥–¥–µ –≤—ã –µ–≥–æ –ø–æ–∫—É–ø–∞–ª–∏)"
    echo "  2. –ù–∞–π–¥–∏—Ç–µ —Ä–∞–∑–¥–µ–ª 'DNS' –∏–ª–∏ '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ DNS'"
    echo "  3. –°–æ–∑–¥–∞–π—Ç–µ A-–∑–∞–ø–∏—Å—å:"
    echo "     - –¢–∏–ø: A"
    echo "     - –ò–º—è: @ (–∏–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º)"
    echo "     - –ó–Ω–∞—á–µ–Ω–∏–µ: $SERVER_IP"
    echo "     - TTL: 3600 (–∏–ª–∏ Auto)"
    echo "  4. –ü–æ–¥–æ–∂–¥–∏—Ç–µ 5-60 –º–∏–Ω—É—Ç –¥–ª—è —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è DNS"
    echo ""
    echo "üìñ –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: —Å–º. DNS_SETUP.md"
    exit 1
fi

echo "‚úÖ DNS –∑–∞–ø–∏—Å—å –Ω–∞–π–¥–µ–Ω–∞: $DOMAIN ‚Üí $DOMAIN_IP"
echo ""

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è IP
if [ "$DOMAIN_IP" == "$SERVER_IP" ]; then
    echo "‚úÖ DNS –∑–∞–ø–∏—Å—å —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π IP —Å–µ—Ä–≤–µ—Ä–∞!"
    echo ""
    echo "üéâ DNS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ. –ú–æ–∂–Ω–æ –ø–æ–ª—É—á–∞—Ç—å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç."
    exit 0
else
    echo "‚ùå –ü—Ä–æ–±–ª–µ–º–∞: DNS –∑–∞–ø–∏—Å—å —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –¥—Ä—É–≥–æ–π IP!"
    echo "   –î–æ–º–µ–Ω —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞: $DOMAIN_IP"
    echo "   –°–µ—Ä–≤–µ—Ä –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–∞: $SERVER_IP"
    echo ""
    echo "üìã –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:"
    echo "  1. –ó–∞–π–¥–∏—Ç–µ –≤ –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–∞—à–µ–≥–æ –¥–æ–º–µ–Ω–∞"
    echo "  2. –ù–∞–π–¥–∏—Ç–µ A-–∑–∞–ø–∏—Å—å –¥–ª—è $DOMAIN"
    echo "  3. –ò–∑–º–µ–Ω–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–∞: $SERVER_IP"
    echo "  4. –ü–æ–¥–æ–∂–¥–∏—Ç–µ 5-60 –º–∏–Ω—É—Ç –¥–ª—è —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è DNS"
    echo "  5. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç —Å–Ω–æ–≤–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏"
    echo ""
    echo "üìñ –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: —Å–º. DNS_SETUP.md"
    exit 1
fi




