// –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Supabase
// –í—ã–ø–æ–ª–Ω–∏—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞

console.log('üîå –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Supabase...');

// –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
console.log('VITE_SUPABASE_URL:', import.meta.env.VITE_SUPABASE_URL);
console.log('VITE_SUPABASE_ANON_KEY:', import.meta.env.VITE_SUPABASE_ANON_KEY ? '–ï—Å—Ç—å' : '–ù–µ—Ç');

// –°–æ–∑–¥–∞–µ–º –∫–ª–∏–µ–Ω—Ç Supabase
import { createClient } from '@supabase/supabase-js';

const supabaseUrl = 'https://fguwtuaxtjrojgjnxchv.supabase.co';
const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZndXd0dWF4dGpyb2pnam54Y2h2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgwNDg0ODUsImV4cCI6MjA3MzYyNDQ4NX0.-NyA5IJkBuYG-qMABFNQ5KFw38q8RHdg182Eswwddlw';

const supabase = createClient(supabaseUrl, supabaseKey);

// –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
console.log('–¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...');

// 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∞–±–ª–∏—Ü—ã
supabase.from('carts').select('count').limit(1)
  .then(({ data, error }) => {
    if (error) {
      console.error('‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Ç–∞–±–ª–∏—Ü–µ carts:', error);
    } else {
      console.log('‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Ç–∞–±–ª–∏—Ü–µ carts —Ä–∞–±–æ—Ç–∞–µ—Ç');
    }
  });

// 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∞–±–ª–∏—Ü—É dishes
supabase.from('dishes').select('count').limit(1)
  .then(({ data, error }) => {
    if (error) {
      console.error('‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Ç–∞–±–ª–∏—Ü–µ dishes:', error);
    } else {
      console.log('‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Ç–∞–±–ª–∏—Ü–µ dishes —Ä–∞–±–æ—Ç–∞–µ—Ç');
    }
  });

// 3. –ü—Ä–æ–≤–µ—Ä—è–µ–º RLS —Å—Ç–∞—Ç—É—Å
supabase.from('carts').select('*').limit(1)
  .then(({ data, error }) => {
    if (error) {
      console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ carts:', error);
      console.log('–í–æ–∑–º–æ–∂–Ω–æ, –ø—Ä–æ–±–ª–µ–º–∞ —Å RLS –ø–æ–ª–∏—Ç–∏–∫–∞–º–∏');
    } else {
      console.log('‚úÖ –î–∞–Ω–Ω—ã–µ –∏–∑ carts –ø–æ–ª—É—á–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ:', data);
    }
  });

// 4. –¢–µ—Å—Ç–∏—Ä—É–µ–º –≤—Å—Ç–∞–≤–∫—É
const testSessionId = 'test_' + Date.now();
supabase.from('carts').insert([{ session_id: testSessionId }]).select()
  .then(({ data, error }) => {
    if (error) {
      console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—Å—Ç–∞–≤–∫–µ –≤ carts:', error);
    } else {
      console.log('‚úÖ –í—Å—Ç–∞–≤–∫–∞ –≤ carts —Ä–∞–±–æ—Ç–∞–µ—Ç:', data);
      
      // –£–¥–∞–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤—É—é –∑–∞–ø–∏—Å—å
      if (data && data[0]) {
        supabase.from('carts').delete().eq('id', data[0].id)
          .then(() => console.log('‚úÖ –¢–µ—Å—Ç–æ–≤–∞—è –∑–∞–ø–∏—Å—å —É–¥–∞–ª–µ–Ω–∞'));
      }
    }
  });
