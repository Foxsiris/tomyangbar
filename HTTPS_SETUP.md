# üîí –ù–∞—Å—Ç—Ä–æ–π–∫–∞ HTTPS –¥–ª—è Tom Yang Bar

–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ SSL/HTTPS —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞, —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–æ–≥–æ —á–µ—Ä–µ–∑ Docker Compose.

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- –î–æ–º–µ–Ω, —É–∫–∞–∑—ã–≤–∞—é—â–∏–π –Ω–∞ IP –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ (A-–∑–∞–ø–∏—Å—å)
- –î–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–µ—Ä—É –ø–æ SSH
- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ Docker –∏ Docker Compose

> **–ù–µ—Ç –¥–æ–º–µ–Ω–∞?** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ [HTTPS –±–µ–∑ –¥–æ–º–µ–Ω–∞ (—Å–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç)](./HTTPS_NO_DOMAIN.md) –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–ª–∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.

## ‚ö° –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞)

–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –¥–æ–º–µ–Ω –∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –±—ã—Å—Ç—Ä–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å HTTPS:

```bash
# 1. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É –ø–æ SSH
ssh user@your-server

# 2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞
cd /path/to/tomyangbar

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–∑–∞–º–µ–Ω–∏—Ç–µ your-domain.com –Ω–∞ –≤–∞—à –¥–æ–º–µ–Ω)
./setup-https.sh your-domain.com
```

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –û—Å—Ç–∞–Ω–æ–≤–∏—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç certbot (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
- –ü–æ–ª—É—á–∏—Ç SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
- –ù–∞—Å—Ç—Ä–æ–∏—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
- –ó–∞–ø—É—Å—Ç–∏—Ç –ø—Ä–æ–µ–∫—Ç —Å HTTPS

**–ì–æ—Ç–æ–≤–æ!** –û—Ç–∫—Ä–æ–π—Ç–µ `https://your-domain.com` –≤ –±—Ä–∞—É–∑–µ—Ä–µ.

---

## üöÄ –í–∞—Ä–∏–∞–Ω—Ç 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å Certbot (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–≠—Ç–æ—Ç –≤–∞—Ä–∏–∞–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞–µ—Ç –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –æ—Ç Let's Encrypt.

### –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Certbot –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

```bash
# –î–ª—è Ubuntu/Debian
sudo apt update
sudo apt install certbot

# –î–ª—è CentOS/RHEL
sudo yum install certbot
```

### –®–∞–≥ 2: –ü–æ–ª—É—á–µ–Ω–∏–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞

**–í–∞–∂–Ω–æ**: –ó–∞–º–µ–Ω–∏—Ç–µ `your-domain.com` –Ω–∞ –≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π –¥–æ–º–µ–Ω!

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ç–µ–∫—É—â–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
cd /path/to/tomyangbar
docker-compose down

# –ü–æ–ª—É—á–∏—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (–∑–∞–º–µ–Ω–∏—Ç–µ your-domain.com –Ω–∞ –≤–∞—à –¥–æ–º–µ–Ω)
sudo certbot certonly --standalone -d your-domain.com

# –ï—Å–ª–∏ —É –≤–∞—Å –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–æ–º–µ–Ω–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å www):
# sudo certbot certonly --standalone -d your-domain.com -d www.your-domain.com
```

Certbot —Å–æ–∑–¥–∞—Å—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –≤ `/etc/letsencrypt/live/your-domain.com/`

### –®–∞–≥ 3: –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

```bash
# –°–æ–∑–¥–∞–π—Ç–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –≤ –ø—Ä–æ–µ–∫—Ç–µ
mkdir -p ssl

# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã (–∑–∞–º–µ–Ω–∏—Ç–µ your-domain.com)
sudo cp /etc/letsencrypt/live/your-domain.com/fullchain.pem ./ssl/
sudo cp /etc/letsencrypt/live/your-domain.com/privkey.pem ./ssl/

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞
sudo chmod 644 ./ssl/fullchain.pem
sudo chmod 600 ./ssl/privkey.pem
sudo chown $USER:$USER ./ssl/*
```

### –®–∞–≥ 4: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–û–±–Ω–æ–≤–∏—Ç–µ —Ñ–∞–π–ª `.env`:

```bash
nano .env
```

–ò–∑–º–µ–Ω–∏—Ç–µ `FRONTEND_URL` –Ω–∞ HTTPS:

```env
FRONTEND_URL=https://your-domain.com
```

### –®–∞–≥ 5: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ docker-compose.yml

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–æ–≤—ã–π —Ñ–∞–π–ª `docker-compose.https.yml`:

```bash
# –ü–µ—Ä–µ–∏–º–µ–Ω—É–π—Ç–µ —Å—Ç–∞—Ä—ã–π —Ñ–∞–π–ª (–¥–ª—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏)
cp docker-compose.yml docker-compose.http.yml

# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS –≤–µ—Ä—Å–∏—é
cp docker-compose.https.yml docker-compose.yml
```

–ò–ª–∏ –∑–∞–ø—É—Å–∫–∞–π—Ç–µ –Ω–∞–ø—Ä—è–º—É—é:

```bash
docker-compose -f docker-compose.https.yml up -d --build
```

### –®–∞–≥ 6: –ó–∞–ø—É—Å–∫ —Å HTTPS

```bash
docker-compose up -d --build
```

### –®–∞–≥ 7: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

–°–æ–∑–¥–∞–π—Ç–µ cron –∑–∞–¥–∞—á—É –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤:

```bash
# –û—Ç–∫—Ä–æ–π—Ç–µ crontab
sudo crontab -e

# –î–æ–±–∞–≤—å—Ç–µ —Å—Ç—Ä–æ–∫—É (–æ–±–Ω–æ–≤–∏—Ç–µ –ø—É—Ç—å –∏ –¥–æ–º–µ–Ω):
0 3 * * * cd /path/to/tomyangbar && certbot renew --quiet && cp /etc/letsencrypt/live/your-domain.com/fullchain.pem ./ssl/ && cp /etc/letsencrypt/live/your-domain.com/privkey.pem ./ssl/ && docker-compose restart frontend
```

–≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ –±—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 3:00 –Ω–æ—á–∏ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä.

## üîß –í–∞—Ä–∏–∞–Ω—Ç 2: –†—É—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω –±–æ–ª—å—à–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å)

### –®–∞–≥ 1: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ –≤—Ä—É—á–Ω—É—é

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker-compose down

# –ü–æ–ª—É—á–∏—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
sudo certbot certonly --standalone -d your-domain.com
```

### –®–∞–≥ 2: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–°–ª–µ–¥—É–π—Ç–µ —à–∞–≥–∞–º 3-6 –∏–∑ –í–∞—Ä–∏–∞–Ω—Ç–∞ 1.

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã Let's Encrypt –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã 90 –¥–Ω–µ–π. –î–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:

```bash
# –û–±–Ω–æ–≤–∏—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
sudo certbot renew

# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –Ω–æ–≤—ã–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
sudo cp /etc/letsencrypt/live/your-domain.com/fullchain.pem ./ssl/
sudo cp /etc/letsencrypt/live/your-domain.com/privkey.pem ./ssl/

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ frontend –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker-compose restart frontend
```

## üõ†Ô∏è –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã HTTPS

1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: `https://your-domain.com`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤ –∞–¥—Ä–µ—Å–Ω–æ–π —Å—Ç—Ä–æ–∫–µ –µ—Å—Ç—å –∑–∞–º–æ—á–µ–∫ üîí
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ API: `https://your-domain.com/api/health`

## üî• –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Firewall

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ—Ä—Ç—ã 80 –∏ 443 –æ—Ç–∫—Ä—ã—Ç—ã:

```bash
# –î–ª—è UFW
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw reload

# –î–ª—è firewalld
sudo firewall-cmd --permanent --add-service=http
sudo firewall-cmd --permanent --add-service=https
sudo firewall-cmd --reload
```

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: "Port 80 is already in use"

Certbot –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ—Ä—Ç 80 –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ–º–µ–Ω–∞. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –ø–µ—Ä–µ–¥ –ø–æ–ª—É—á–µ–Ω–∏–µ–º —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞:

```bash
docker-compose down
```

### –ü—Ä–æ–±–ª–µ–º–∞: "Failed to obtain certificate"

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ:
- –î–æ–º–µ–Ω —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ IP –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ: `dig your-domain.com`)
- –ü–æ—Ä—Ç 80 –æ—Ç–∫—Ä—ã—Ç –∏ –¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑–≤–Ω–µ
- –ù–µ—Ç –¥—Ä—É–≥–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏—Ö –ø–æ—Ä—Ç 80

### –ü—Ä–æ–±–ª–µ–º–∞: "SSL certificate not found"

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—É—Ç–∏ –∫ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º:

```bash
ls -la ssl/
# –î–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ñ–∞–π–ª—ã: fullchain.pem –∏ privkey.pem
```

### –ü—Ä–æ–±–ª–µ–º–∞: "Mixed content" –≤ –±—Ä–∞—É–∑–µ—Ä–µ

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `FRONTEND_URL` –≤ `.env` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `https://`:

```env
FRONTEND_URL=https://your-domain.com
```

–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã:

```bash
docker-compose up -d --build
```

## üìù –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–î–æ–º–µ–Ω –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω**: Let's Encrypt —Ç—Ä–µ–±—É–µ—Ç –≤–∞–ª–∏–¥–Ω—ã–π –¥–æ–º–µ–Ω, —Ä–∞–±–æ—Ç–∞—é—â–∏–π –Ω–∞ IP –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
2. **–ü–æ—Ä—Ç 80**: –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç–∫—Ä—ã—Ç –¥–ª—è –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ–º–µ–Ω–∞
3. **–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ cron –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
4. **–†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è**: –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Å—Ç–∞—Ä—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é (`docker-compose.http.yml`) –Ω–∞ —Å–ª—É—á–∞–π –æ—Ç–∫–∞—Ç–∞

## üîÑ –û—Ç–∫–∞—Ç –Ω–∞ HTTP (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ HTTP:

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker-compose down

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å—Ç–∞—Ä—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
cp docker-compose.http.yml docker-compose.yml

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–Ω–æ–≤–∞
docker-compose up -d
```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [Let's Encrypt Documentation](https://letsencrypt.org/docs/)
- [Certbot Documentation](https://certbot.eff.org/)
- [Nginx SSL Configuration](https://nginx.org/en/docs/http/configuring_https_servers.html)

